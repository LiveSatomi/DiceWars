<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_25) on Sun Mar 01 13:36:13 EST 2015 -->
<title>DelegateManager</title>
<meta name="date" content="2015-03-01">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="DelegateManager";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../../com/android/layoutlib/bridge/impl/FontLoader.html" title="class in com.android.layoutlib.bridge.impl"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/android/layoutlib/bridge/impl/DelegateManager.html" target="_top">Frames</a></li>
<li><a href="DelegateManager.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.android.layoutlib.bridge.impl</div>
<h2 title="Class DelegateManager" class="title">Class DelegateManager&lt;T&gt;</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>com.android.layoutlib.bridge.impl.DelegateManager&lt;T&gt;</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt><span class="paramLabel">Type Parameters:</span></dt>
<dd><code>T</code> - the delegate class to manage</dd>
</dl>
<hr>
<br>
<pre>public final class <span class="typeNameLabel">DelegateManager&lt;T&gt;</span>
extends java.lang.Object</pre>
<div class="block">Manages native delegates.

 This is used in conjunction with layoublib_create: certain Android java classes are mere
 wrappers around a heavily native based implementation, and we need a way to run these classes
 in our Eclipse rendering framework without bringing all the native code from the Android
 platform.

 Thus we instruct layoutlib_create to modify the bytecode of these classes to replace their
 native methods by "delegate calls".

 For example, a native method android.graphics.Matrix.init(...) will actually become
 a call to android.graphics.Matrix_Delegate.init(...).

 The Android java classes that use native code uses an int (Java side) to reference native
 objects. This int is generally directly the pointer to the C structure counterpart.
 Typically a creation method will return such an int, and then this int will be passed later
 to a Java method to identify the C object to manipulate.

 Since we cannot use the Java object reference as the int directly, DelegateManager manages the
 int -> Delegate class link.

 Native methods usually always have the int as parameters. The first thing the delegate method
 will do is call <a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html#getDelegate-int-"><code>getDelegate(int)</code></a> to get the Java object matching the int.

 Typical native init methods are returning a new int back to the Java class, so
 <a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html#addNewDelegate-T-"><code>addNewDelegate(Object)</code></a> does the same.

 The JNI references are counted, so we do the same through a <code>WeakReference</code>. Because
 the Java object needs to count as a reference (even though it only holds an int), we use the
 following mechanism:

 - <a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html#addNewDelegate-T-"><code>addNewDelegate(Object)</code></a> and <a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html#removeJavaReferenceFor-int-"><code>removeJavaReferenceFor(int)</code></a> adds and removes
   the delegate to/from a list. This list hold the reference and prevents the GC from reclaiming
   the delegate.

 - <a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html#addNewDelegate-T-"><code>addNewDelegate(Object)</code></a> also adds the delegate to a <code>SparseArray</code> that holds a
   <code>WeakReference</code> to the delegate. This allows the delegate to be deleted automatically
   when nothing references it. This means that any class that holds a delegate (except for the
   Java main class) must not use the int but the Delegate class instead. The integers must
   only be used in the API between the main Java class and the Delegate.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html#DelegateManager-java.lang.Class-">DelegateManager</a></span>(java.lang.Class&lt;<a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html" title="type parameter in DelegateManager">T</a>&gt;&nbsp;theClass)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html#addNewDelegate-T-">addNewDelegate</a></span>(<a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html" title="type parameter in DelegateManager">T</a>&nbsp;newDelegate)</code>
<div class="block">Adds a delegate to the manager and returns the native int used to identify it.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code><a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html" title="type parameter in DelegateManager">T</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html#getDelegate-int-">getDelegate</a></span>(int&nbsp;native_object)</code>
<div class="block">Returns the delegate from the given native int.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html#removeJavaReferenceFor-int-">removeJavaReferenceFor</a></span>(int&nbsp;native_object)</code>
<div class="block">Removes the main reference on the given delegate.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="DelegateManager-java.lang.Class-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>DelegateManager</h4>
<pre>public&nbsp;DelegateManager(java.lang.Class&lt;<a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html" title="type parameter in DelegateManager">T</a>&gt;&nbsp;theClass)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getDelegate-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getDelegate</h4>
<pre>public&nbsp;<a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html" title="type parameter in DelegateManager">T</a>&nbsp;getDelegate(int&nbsp;native_object)</pre>
<div class="block">Returns the delegate from the given native int.
 <p>
 If the int is zero, then this will always return null.
 <p>
 If the int is non zero and the delegate is not found, this will throw an assert.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>native_object</code> - the native int.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the delegate or null if not found.</dd>
</dl>
</li>
</ul>
<a name="addNewDelegate-java.lang.Object-">
<!--   -->
</a><a name="addNewDelegate-T-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>addNewDelegate</h4>
<pre>public&nbsp;int&nbsp;addNewDelegate(<a href="../../../../../com/android/layoutlib/bridge/impl/DelegateManager.html" title="type parameter in DelegateManager">T</a>&nbsp;newDelegate)</pre>
<div class="block">Adds a delegate to the manager and returns the native int used to identify it.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>newDelegate</code> - the delegate to add</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a unique native int to identify the delegate</dd>
</dl>
</li>
</ul>
<a name="removeJavaReferenceFor-int-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>removeJavaReferenceFor</h4>
<pre>public&nbsp;void&nbsp;removeJavaReferenceFor(int&nbsp;native_object)</pre>
<div class="block">Removes the main reference on the given delegate.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>native_object</code> - the native integer representing the delegate.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../../com/android/layoutlib/bridge/impl/FontLoader.html" title="class in com.android.layoutlib.bridge.impl"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/android/layoutlib/bridge/impl/DelegateManager.html" target="_top">Frames</a></li>
<li><a href="DelegateManager.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
